// [ëª¨ë“ˆ ê°€ì ¸ì˜¤ê¸°: use ë¬¸ë²•]
// - `::` (ë”ë¸” ì½œë¡ ): íŒŒì¼ ê²½ë¡œë¥¼ íƒ€ê³  ë“¤ì–´ê°€ëŠ” 'ë‚´ë¹„ê²Œì´ì…˜'ìž…ë‹ˆë‹¤.
// - `{}`: í•œ ê²½ë¡œ ì•ˆì—ì„œ ì—¬ëŸ¬ ì•„ì´í…œì„ ë¬¶ì–´ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
use axum::{
    routing::get, // [í•¨ìˆ˜] snake_case. `axum/routing` ëª¨ë“ˆ ì•ˆì˜ `get` í•¨ìˆ˜.
    Router,       // [êµ¬ì¡°ì²´] UpperCamelCase. `axum` ë£¨íŠ¸ì˜ `Router` í´ëž˜ìŠ¤(êµ¬ì¡°ì²´).
};
use tokio::net::TcpListener;

// [ì ˆì°¨ì  ë§¤í¬ë¡œ (Procedural Macro)]
// - ì—­í• : "ì½”ë“œ ìƒì„± ë¡œë´‡". ì»´íŒŒì¼ íƒ€ìž„ì— ì•„ëž˜ì˜ `main` í•¨ìˆ˜ë¥¼ ë¹„ë™ê¸° ëŸ°íƒ€ìž„ ì½”ë“œë¡œ ê°ì‹¸ì¤ë‹ˆë‹¤.
// - Python ë¹„ìœ : `@decorator`ì™€ ë¹„ìŠ·í•˜ì§€ë§Œ, ì‹¤ì œë¡œëŠ” ì½”ë“œë¥¼ ìž¬ìž‘ì„±í•©ë‹ˆë‹¤.
// - Node.js ë¹„ìœ : `libuv` ê°™ì€ ì´ë²¤íŠ¸ ë£¨í”„(ì—”ì§„)ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì‹œë™ ê±°ëŠ” ì½”ë“œìž…ë‹ˆë‹¤.
#[tokio::main]
async fn main() {
    // [ë¹Œë” íŒ¨í„´ (Builder Pattern)]
    // 1. `Router::new()`:
    //    - `::`ëŠ” ì—°ê´€ í•¨ìˆ˜(Associated Function) í˜¸ì¶œìž…ë‹ˆë‹¤. (Pythonì˜ @staticmethod, ìƒì„±ìž)
    //    - ë¹ˆ Router ì¸ìŠ¤í„´ìŠ¤(ê³µìž¥)ë¥¼ í•˜ë‚˜ ë§Œë“­ë‹ˆë‹¤.
    //
    // 2. `.route(ê²½ë¡œ, í•¸ë“¤ëŸ¬)`:
    //    - `.`ì€ ë©”ì„œë“œ(Method) í˜¸ì¶œìž…ë‹ˆë‹¤. ì¸ìŠ¤í„´ìŠ¤ê°€ ìžˆì–´ì•¼ ì“¸ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
    //    - í•µì‹¬: ì´ ë©”ì„œë“œëŠ” ìž‘ì—…ì„ ë§ˆì¹˜ê³  **ìˆ˜ì •ëœ Router ê°ì²´ ìžì‹ (Self)**ì„ ë‹¤ì‹œ ë¦¬í„´í•©ë‹ˆë‹¤.
    //    - ê·¸ëž˜ì„œ ë’¤ì— ê³„ì† `.`ì„ ë¶™ì—¬ì„œ ì²´ì´ë‹(Chaining)ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. (jQuery, Promise ì²˜ëŸ¼)
    let app = Router::new()
        .route("/", get(root_handler))
        .route("/health", get(health_check_handler)); // ì˜¤íƒ€ ìˆ˜ì •: hanlder -> handler

    let addr = "0.0.0.0:3000";

    // [ì„ ì–¸ì  ë§¤í¬ë¡œ (Declarative Macro)]
    // - ì´ë¦„ ë’¤ì— `!`ê°€ ë¶™ìœ¼ë©´ ë§¤í¬ë¡œìž…ë‹ˆë‹¤.
    // - í•¨ìˆ˜ì™€ ë‹¬ë¦¬ ì¸ìž ê°œìˆ˜ê°€ ê°€ë³€ì ì¼ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
    // - ì¤‘ìš”: `addr` ë³€ìˆ˜ì˜ **ì†Œìœ ê¶Œ(Ownership)ì„ ê°€ì ¸ê°€ì§€ ì•Šê³ **, ìž ì‹œ ë¹Œë ¤ì„œ(Borrow) ì¶œë ¥ë§Œ í•©ë‹ˆë‹¤.
    println!("ðŸš€ Server Listening on {}", addr);

    // [ë¹„ë™ê¸° ì‹¤í–‰ ë° ì—ëŸ¬ ì²˜ë¦¬]
    // 1. `TcpListener::bind(addr)`: í¬íŠ¸ë¥¼ ì ìœ í•˜ê² ë‹¤ëŠ” ìš”ì²­ (ì•„ì§ ì‹¤í–‰ ì•ˆ ë¨/Lazy).
    // 2. `.await`: "ê¸°ë‹¤ë¦´ê²Œ". ì—¬ê¸°ì„œ ë¹„ë™ê¸° ìž‘ì—…ì´ ì§„ì§œë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤. (Pythonì˜ awaitì™€ ê°™ìŒ)
    // 3. `.unwrap()`: "ìƒë‚¨ìžì‹ ì—ëŸ¬ ì²˜ë¦¬".
    //    - ì„±ê³µí•˜ë©´ ê²°ê³¼(Listener)ë¥¼ êº¼ë‚´ê³ , ì‹¤íŒ¨í•˜ë©´ í”„ë¡œê·¸ëž¨ íŽ‘! í„°íŠ¸ë ¤(Panic).
    let listener: TcpListener = TcpListener::bind(addr).await.unwrap();

    // [ì„œë²„ ì‹¤í–‰ ë° ì†Œìœ ê¶Œ ì´ë™]
    // - `axum::serve`: ë§Œë“¤ì–´ì§„ listenerì™€ appì„ ë°›ì•„ì„œ ì„œë²„ë¥¼ ë„ì›ë‹ˆë‹¤.
    // - ì¤‘ìš”: `listener`ì™€ `app` ë³€ìˆ˜ëŠ” ì´ í•¨ìˆ˜ ì•ˆìœ¼ë¡œ **ì´ì‚¬(Move)** ê°‘ë‹ˆë‹¤.
    // - ë”°ë¼ì„œ ì´ ì¤„ ë°‘ì—ì„œëŠ” `app`ì´ë‚˜ `listener`ë¥¼ ë” ì´ìƒ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    axum::serve(listener, app).await.unwrap();
}

// [í•¸ë“¤ëŸ¬ í•¨ìˆ˜]
// - `async fn`: ë¹„ë™ê¸° í•¨ìˆ˜. í˜¸ì¶œí•˜ë©´ ì¦‰ì‹œ ì‹¤í–‰ë˜ì§€ ì•Šê³  `Future`ë¼ëŠ” ê³„íšì„œë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤.
// - ë°˜í™˜ íƒ€ìž… `&'static str`:
//   - "ë©”ëª¨ë¦¬ì— ì˜ì›ížˆ ë°•ì œëœ ë¬¸ìžì—´" (ì•ˆë‚´ë¬¸ ìŠ¤í‹°ì»¤).
//   - íž™ ë©”ëª¨ë¦¬ í• ë‹¹ì´ ì—†ì–´ì„œ ë§¤ìš° ë¹ ë¦…ë‹ˆë‹¤.
//   - ë‚´ìš©ì´ ë³€í•˜ì§€ ì•ŠëŠ” í—¬ìŠ¤ ì²´í¬ë‚˜ ê³ ì •ëœ ë©”ì‹œì§€ì— ì£¼ë¡œ ì”ë‹ˆë‹¤.
async fn root_handler() -> &'static str {
    "Hello, Rust Server!"
}

async fn health_check_handler() -> &'static str {
    "OK"
}